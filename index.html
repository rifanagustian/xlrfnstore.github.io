<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFNSTORE - Penjualan Kuota Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .sidebar-mobile-hidden { transform: translateX(-100%); }
            .sidebar-mobile-visible { transform: translateX(0); }
            .main-content-mobile { margin-left: 0 !important; }
            .mobile-overlay { display: block; }
            .desktop-only { display: none; }
            .mobile-only { display: block; }
            
            /* Mobile grid adjustments */
            .mobile-grid-1 { grid-template-columns: 1fr; }
            .mobile-grid-2 { grid-template-columns: repeat(2, 1fr); }
            
            /* Mobile text sizes */
            .mobile-text-sm { font-size: 0.875rem; }
            .mobile-text-xs { font-size: 0.75rem; }
            
            /* Mobile padding adjustments */
            .mobile-p-4 { padding: 1rem; }
            .mobile-p-3 { padding: 0.75rem; }
            .mobile-px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
            .mobile-py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        }
        
        @media (min-width: 769px) {
            .mobile-only { display: none; }
            .desktop-only { display: block; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 w-96 max-w-md mx-4 shadow-2xl">
            <div class="text-center mb-6">
                <i class="fas fa-wifi text-4xl text-blue-600 mb-4"></i>
                <h2 id="authTitle" class="text-2xl font-bold text-gray-800">Login RFNSTORE</h2>
                <p id="authSubtitle" class="text-gray-600 mt-2">Masuk ke akun Anda</p>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan username">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan password">
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                    <i class="fas fa-sign-in-alt mr-2"></i>Masuk
                </button>
            </form>

            <!-- Register Form -->
            <form id="registerForm" class="space-y-4 hidden">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input type="text" id="regUsername" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Pilih username">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="regEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan email">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nomor HP</label>
                    <input type="tel" id="regPhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="08xxxxxxxxxx">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="regPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Buat password">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password</label>
                    <input type="password" id="regConfirmPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Ulangi password">
                </div>
                
                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200 font-medium">
                    <i class="fas fa-user-plus mr-2"></i>Daftar
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <div id="loginFooter">
                    <p class="text-sm text-gray-600 mb-2">Belum punya akun?</p>
                    <button onclick="showRegisterForm()" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                        Daftar Sekarang
                    </button>
                </div>
                
                <div id="registerFooter" class="hidden">
                    <p class="text-sm text-gray-600 mb-2">Sudah punya akun?</p>
                    <button onclick="showLoginForm()" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                        Masuk di sini
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="mainApp" class="hidden">
        <!-- Mobile Overlay -->
        <div id="mobileOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden mobile-overlay" onclick="closeMobileSidebar()"></div>
        
        <!-- Sidebar -->
        <div id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-white shadow-xl z-40 sidebar-transition md:translate-x-0 -translate-x-full">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-wifi text-2xl text-blue-600"></i>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">RFNSTORE</h1>
                        <p id="userRole" class="text-sm text-gray-600"></p>
                    </div>
                </div>
            </div>
            
            <nav class="mt-6">
                <a href="#" onclick="showSection('dashboard')" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <i class="fas fa-home mr-3"></i>Dashboard
                </a>
                <a href="#" onclick="showSection('products')" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <i class="fas fa-list mr-3"></i>Daftar Kuota
                </a>
                <a href="#" onclick="showSection('orders')" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <i class="fas fa-shopping-cart mr-3"></i>Pesanan Saya
                </a>
                <a href="#" onclick="showSection('topup')" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                    <i class="fas fa-credit-card mr-3"></i>Top Up Saldo
                </a>
                <div id="adminMenu" class="hidden">
                    <a href="#" onclick="showSection('manage')" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                        <i class="fas fa-cog mr-3"></i>Kelola Kuota
                    </a>
                    <a href="#" onclick="showSection('topupAdmin')" class="nav-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition duration-200">
                        <i class="fas fa-money-check-alt mr-3"></i>Konfirmasi Top Up
                        <span id="pendingTopupBadge" class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full hidden">0</span>
                    </a>
                </div>
            </nav>
            
            <div class="absolute bottom-6 left-6 right-6">
                <button onclick="logout()" class="w-full flex items-center justify-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-200">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="md:ml-64 min-h-screen">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200 p-4 md:p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <!-- Mobile Menu Button -->
                        <button id="mobileMenuBtn" onclick="toggleMobileSidebar()" class="md:hidden p-2 rounded-lg hover:bg-gray-100">
                            <i class="fas fa-bars text-gray-600"></i>
                        </button>
                        <h2 id="pageTitle" class="text-xl md:text-2xl font-bold text-gray-800">Dashboard</h2>
                    </div>
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <div class="text-right hidden sm:block">
                            <p class="text-sm text-gray-600">Selamat datang,</p>
                            <p id="currentUser" class="font-medium text-gray-800 text-sm md:text-base"></p>
                        </div>
                        <div class="w-8 h-8 md:w-10 md:h-10 bg-blue-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white text-sm md:text-base"></i>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="p-4 md:p-6">
                <!-- Dashboard Section -->
                <div id="dashboardSection" class="section fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8">
                        <div class="bg-white rounded-xl p-4 md:p-6 shadow-lg card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-xs md:text-sm">Total Kuota</p>
                                    <p id="totalQuota" class="text-xl md:text-2xl font-bold text-blue-600">12</p>
                                </div>
                                <i class="fas fa-wifi text-2xl md:text-3xl text-blue-600"></i>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-4 md:p-6 shadow-lg card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-xs md:text-sm">Pesanan Saya</p>
                                    <p id="myOrders" class="text-xl md:text-2xl font-bold text-green-600">0</p>
                                </div>
                                <i class="fas fa-shopping-cart text-2xl md:text-3xl text-green-600"></i>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-4 md:p-6 shadow-lg card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-xs md:text-sm">Saldo</p>
                                    <p class="text-xl md:text-2xl font-bold text-purple-600 balance-display">Rp 0</p>
                                </div>
                                <i class="fas fa-wallet text-2xl md:text-3xl text-purple-600"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-4 md:p-6 shadow-lg">
                        <h3 class="text-base md:text-lg font-semibold text-gray-800 mb-4">Kuota Populer</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4" id="popularQuota">
                            <!-- Popular quota items will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div id="productsSection" class="section hidden fade-in">
                    <div class="bg-white rounded-xl shadow-lg">
                        <div class="p-4 md:p-6 border-b border-gray-200">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                                <h3 class="text-base md:text-lg font-semibold text-gray-800">Daftar Kuota Tersedia</h3>
                                <div class="flex items-center space-x-2 md:space-x-4">
                                    <select id="providerFilter" class="px-3 md:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm md:text-base">
                                        <option value="">Semua Provider</option>
                                        <option value="Telkomsel">Telkomsel</option>
                                        <option value="Indosat">Indosat</option>
                                        <option value="XL">XL</option>
                                        <option value="Tri">Tri</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 md:p-6">
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6" id="quotaList">
                                <!-- Quota items will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Section -->
                <div id="ordersSection" class="section hidden fade-in">
                    <div class="bg-white rounded-xl shadow-lg">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Riwayat Pesanan</h3>
                        </div>
                        
                        <div class="p-6">
                            <div id="ordersList" class="space-y-4">
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-shopping-cart text-4xl mb-4"></i>
                                    <p>Belum ada pesanan</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Up Section -->
                <div id="topupSection" class="section hidden fade-in">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                        <!-- Top Up Form -->
                        <div class="bg-white rounded-xl shadow-lg">
                            <div class="p-4 md:p-6 border-b border-gray-200">
                                <h3 class="text-base md:text-lg font-semibold text-gray-800">Top Up Saldo</h3>
                                <p class="text-gray-600 text-xs md:text-sm mt-1">Isi saldo untuk membeli kuota</p>
                            </div>
                            
                            <div class="p-4 md:p-6">
                                <form id="topupForm" class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Nominal</label>
                                        <div class="grid grid-cols-2 gap-2 md:gap-3 mb-4">
                                            <button type="button" onclick="selectAmount(10000)" class="amount-btn border-2 border-gray-300 rounded-lg p-2 md:p-3 text-center hover:border-blue-500 hover:bg-blue-50 transition duration-200">
                                                <div class="font-medium text-sm md:text-base">Rp 10.000</div>
                                            </button>
                                            <button type="button" onclick="selectAmount(25000)" class="amount-btn border-2 border-gray-300 rounded-lg p-2 md:p-3 text-center hover:border-blue-500 hover:bg-blue-50 transition duration-200">
                                                <div class="font-medium text-sm md:text-base">Rp 25.000</div>
                                            </button>
                                            <button type="button" onclick="selectAmount(50000)" class="amount-btn border-2 border-gray-300 rounded-lg p-2 md:p-3 text-center hover:border-blue-500 hover:bg-blue-50 transition duration-200">
                                                <div class="font-medium text-sm md:text-base">Rp 50.000</div>
                                            </button>
                                            <button type="button" onclick="selectAmount(100000)" class="amount-btn border-2 border-gray-300 rounded-lg p-2 md:p-3 text-center hover:border-blue-500 hover:bg-blue-50 transition duration-200">
                                                <div class="font-medium text-sm md:text-base">Rp 100.000</div>
                                            </button>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Atau masukkan nominal lain</label>
                                            <input type="number" id="customAmount" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Minimal Rp 10.000" min="10000">
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Metode Pembayaran</label>
                                        <select id="paymentMethod" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="bri">Transfer Bank BRI - RIFAN AGUSTIAN (Recommended)</option>
                                            <option value="bca">Transfer Bank BCA</option>
                                            <option value="mandiri">Transfer Bank Mandiri</option>
                                            <option value="bni">Transfer Bank BNI</option>
                                        </select>
                                    </div>
                                    
                                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                                        <i class="fas fa-credit-card mr-2"></i>Buat Kode Pembayaran
                                    </button>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Payment Instructions -->
                        <div class="bg-white rounded-xl shadow-lg">
                            <div class="p-6 border-b border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-800">Cara Top Up</h3>
                            </div>
                            
                            <div class="p-6">
                                <div class="space-y-4">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">1</div>
                                        <div>
                                            <p class="font-medium text-gray-800">Pilih Nominal</p>
                                            <p class="text-sm text-gray-600">Pilih atau masukkan nominal yang ingin di top up</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start space-x-3">
                                        <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">2</div>
                                        <div>
                                            <p class="font-medium text-gray-800">Pilih Bank</p>
                                            <p class="text-sm text-gray-600">Pilih bank yang akan digunakan untuk transfer</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start space-x-3">
                                        <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">3</div>
                                        <div>
                                            <p class="font-medium text-gray-800">Transfer Sesuai Kode</p>
                                            <p class="text-sm text-gray-600">Transfer sesuai nominal + kode unik yang diberikan</p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start space-x-3">
                                        <div class="w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium">4</div>
                                        <div>
                                            <p class="font-medium text-gray-800">Konfirmasi via WhatsApp</p>
                                            <p class="text-sm text-gray-600">Kirim bukti transfer ke admin untuk diproses manual</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <div class="flex items-center space-x-2">
                                        <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                                        <p class="text-sm font-medium text-yellow-800">Penting!</p>
                                    </div>
                                    <p class="text-sm text-yellow-700 mt-1">Transfer harus sesuai dengan nominal + kode unik yang diberikan. Setelah transfer, wajib konfirmasi via WhatsApp untuk proses manual.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Up History -->
                    <div class="mt-6 bg-white rounded-xl shadow-lg">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Riwayat Top Up</h3>
                        </div>
                        
                        <div class="p-6">
                            <div id="topupHistory" class="space-y-4">
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-credit-card text-4xl mb-4"></i>
                                    <p>Belum ada riwayat top up</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Top Up Management Section -->
                <div id="topupAdminSection" class="section hidden fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-4 md:mb-6">
                        <!-- Stats Cards -->
                        <div class="bg-white rounded-xl p-4 md:p-6 shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-xs md:text-sm">Pending</p>
                                    <p id="pendingTopupCount" class="text-xl md:text-2xl font-bold text-yellow-600">0</p>
                                </div>
                                <i class="fas fa-clock text-2xl md:text-3xl text-yellow-600"></i>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-4 md:p-6 shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-xs md:text-sm">Berhasil Hari Ini</p>
                                    <p id="todaySuccessCount" class="text-xl md:text-2xl font-bold text-green-600">0</p>
                                </div>
                                <i class="fas fa-check-circle text-2xl md:text-3xl text-green-600"></i>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl p-4 md:p-6 shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-xs md:text-sm">Total Hari Ini</p>
                                    <p id="todayTotalAmount" class="text-lg md:text-2xl font-bold text-blue-600">Rp 0</p>
                                </div>
                                <i class="fas fa-money-bill-wave text-2xl md:text-3xl text-blue-600"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pending Top Ups -->
                    <div class="bg-white rounded-xl shadow-lg mb-6">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-800">Top Up Menunggu Konfirmasi</h3>
                                <button onclick="refreshTopupList()" class="text-blue-600 hover:text-blue-800 text-sm">
                                    <i class="fas fa-sync-alt mr-1"></i>Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div id="pendingTopupList" class="space-y-4">
                                <!-- Pending top ups will be inserted here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- All Top Up History -->
                    <div class="bg-white rounded-xl shadow-lg">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-800">Riwayat Semua Top Up</h3>
                                <div class="flex items-center space-x-3">
                                    <select id="statusFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                        <option value="">Semua Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="success">Berhasil</option>
                                        <option value="failed">Gagal</option>
                                        <option value="expired">Kedaluwarsa</option>
                                    </select>
                                    <select id="dateFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                        <option value="">Semua Tanggal</option>
                                        <option value="today">Hari Ini</option>
                                        <option value="week">7 Hari Terakhir</option>
                                        <option value="month">30 Hari Terakhir</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div id="allTopupHistory" class="space-y-4">
                                <!-- All top up history will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Manage Section -->
                <div id="manageSection" class="section hidden fade-in">
                    <div class="bg-white rounded-xl shadow-lg">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-800">Kelola Kuota</h3>
                                <div class="flex items-center space-x-3">
                                    <button id="deleteSelectedBtn" onclick="deleteSelectedQuotas()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200 hidden">
                                        <i class="fas fa-trash mr-2"></i>Hapus Terpilih (<span id="selectedCount">0</span>)
                                    </button>
                                    <button onclick="showAddQuotaModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200">
                                        <i class="fas fa-plus mr-2"></i>Tambah Kuota
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-4 font-medium text-gray-700 w-12">
                                                <input type="checkbox" id="selectAllQuotas" onchange="toggleSelectAll()" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                            </th>
                                            <th class="text-left py-3 px-4 font-medium text-gray-700">Provider</th>
                                            <th class="text-left py-3 px-4 font-medium text-gray-700">Kuota</th>
                                            <th class="text-left py-3 px-4 font-medium text-gray-700">Harga</th>
                                            <th class="text-left py-3 px-4 font-medium text-gray-700">Masa Aktif</th>
                                            <th class="text-left py-3 px-4 font-medium text-gray-700">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="manageQuotaList">
                                        <!-- Admin quota management items will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Add Quota Modal -->
    <div id="addQuotaModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 w-96 max-w-md mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Tambah Kuota Baru</h3>
                <button onclick="closeAddQuotaModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="addQuotaForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Provider</label>
                    <select id="newProvider" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="Telkomsel">Telkomsel</option>
                        <option value="Indosat">Indosat</option>
                        <option value="XL">XL</option>
                        <option value="Tri">Tri</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Kuota</label>
                    <input type="text" id="newQuota" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="contoh: 10GB">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Harga</label>
                    <input type="number" id="newPrice" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="25000">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Masa Aktif</label>
                    <input type="text" id="newDuration" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="30 hari">
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                    <i class="fas fa-plus mr-2"></i>Tambah Kuota
                </button>
            </form>
        </div>
    </div>

    <!-- Purchase Modal -->
    <div id="purchaseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 w-96 max-w-md mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Konfirmasi Pembelian</h3>
                <button onclick="closePurchaseModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="purchaseDetails" class="mb-6">
                <!-- Purchase details will be inserted here -->
            </div>
            
            <form id="purchaseForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nomor HP</label>
                    <input type="tel" id="phoneNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="08xxxxxxxxxx">
                </div>
                
                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200 font-medium">
                    <i class="fas fa-shopping-cart mr-2"></i>Beli Sekarang
                </button>
            </form>
        </div>
    </div>

    <!-- Payment Code Modal -->
    <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-800">Kode Pembayaran</h3>
                <button onclick="closePaymentModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="paymentDetails" class="mb-6">
                <!-- Payment details will be inserted here -->
            </div>
            
            <div class="space-y-4">
                <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fas fa-clock text-red-600"></i>
                        <p class="text-sm font-medium text-red-800">Batas Waktu Pembayaran</p>
                    </div>
                    <p id="paymentTimer" class="text-lg font-bold text-red-600">23:59:45</p>
                </div>
                
                <div id="bankTransferButtons">
                    <button onclick="copyAccountNumber()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-medium mb-2">
                        <i class="fas fa-copy mr-2"></i>Salin Nomor Rekening
                    </button>
                    
                    <button onclick="copyAmount()" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200 font-medium mb-3">
                        <i class="fas fa-copy mr-2"></i>Salin Nominal Transfer
                    </button>
                    
                    <button onclick="confirmPaymentWhatsApp()" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-lg hover:from-green-600 hover:to-green-700 transition duration-200 font-medium">
                        <i class="fab fa-whatsapp mr-2"></i>Konfirmasi via WhatsApp
                    </button>
                </div>
                
                <div id="qrisButtons" class="hidden">
                    <!-- QRIS buttons removed -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let userRole = null;
        
        // Load registered users from localStorage or use default
        let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [
            { username: 'admin', password: 'admin123', role: 'admin', email: 'admin@RFNSTORE.com', phone: '081234567890' },
            { username: 'rifan16', password: '16082002', role: 'admin', email: 'rifan16@example.com', phone: '081234567891' }
        ];
        
        // Save registered users to localStorage
        function saveRegisteredUsers() {
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
        }
        
        // Load quota data from localStorage or use default
        let quotaData = JSON.parse(localStorage.getItem('quotaData')) || [
            { id: 1, provider: 'Telkomsel', quota: '10GB', price: 25000, duration: '30 hari' },
            { id: 2, provider: 'Telkomsel', quota: '20GB', price: 45000, duration: '30 hari' },
            { id: 3, provider: 'Indosat', quota: '15GB', price: 30000, duration: '30 hari' },
            { id: 4, provider: 'XL', quota: '12GB', price: 28000, duration: '30 hari' },
            { id: 5, provider: 'Tri', quota: '25GB', price: 35000, duration: '30 hari' },
            { id: 6, provider: 'Telkomsel', quota: '5GB', price: 15000, duration: '7 hari' },
            { id: 7, provider: 'Indosat', quota: '8GB', price: 20000, duration: '15 hari' },
            { id: 8, provider: 'XL', quota: '30GB', price: 50000, duration: '30 hari' },
            { id: 9, provider: 'Tri', quota: '50GB', price: 65000, duration: '30 hari' },
            { id: 10, provider: 'Telkomsel', quota: '3GB', price: 12000, duration: '3 hari' },
            { id: 11, provider: 'Indosat', quota: '40GB', price: 55000, duration: '30 hari' },
            { id: 12, provider: 'XL', quota: '6GB', price: 18000, duration: '7 hari' }
        ];
        
        // Save quota data to localStorage
        function saveQuotaData() {
            localStorage.setItem('quotaData', JSON.stringify(quotaData));
        }
        
        // Save all top up requests to localStorage
        function saveAllTopupRequests() {
            localStorage.setItem('allTopupRequests', JSON.stringify(allTopupRequests));
        }
        let orders = [];
        let selectedQuota = null;
        let topupHistory = [];
        let allTopupRequests = JSON.parse(localStorage.getItem('allTopupRequests')) || []; // Global top up storage
        let currentPayment = null;
        let paymentTimer = null;
        let userBalance = 0;

        // Load user balance from localStorage
        function loadUserBalance() {
            if (currentUser) {
                const savedBalance = localStorage.getItem('userBalance_' + currentUser);
                if (savedBalance) {
                    userBalance = parseInt(savedBalance);
                } else {
                    userBalance = 0; // Default balance for new users
                }
            }
        }

        // Save user balance to localStorage
        function saveUserBalance() {
            if (currentUser) {
                localStorage.setItem('userBalance_' + currentUser, userBalance.toString());
            }
        }

        // Auth form switching
        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('loginFooter').classList.add('hidden');
            document.getElementById('registerFooter').classList.remove('hidden');

            document.getElementById('authTitle').textContent = 'Daftar RFNSTORE';
            document.getElementById('authSubtitle').textContent = 'Buat akun baru Anda';
        }

        function showLoginForm() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerFooter').classList.add('hidden');
            document.getElementById('loginFooter').classList.remove('hidden');

            document.getElementById('authTitle').textContent = 'Login RFNSTORE';
            document.getElementById('authSubtitle').textContent = 'Masuk ke akun Anda';
        }

        // Register functionality
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            
            // Validation
            if (!username || !email || !phone || !password || !confirmPassword) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Password dan konfirmasi password tidak sama!');
                return;
            }
            
            if (password.length < 6) {
                alert('Password minimal 6 karakter!');
                return;
            }
            
            // Check if username already exists
            if (registeredUsers.find(user => user.username === username)) {
                alert('Username sudah digunakan! Pilih username lain.');
                return;
            }
            
            // Check if email already exists
            if (registeredUsers.find(user => user.email === email)) {
                alert('Email sudah terdaftar! Gunakan email lain.');
                return;
            }
            
            // Add new user
            const newUser = {
                username: username,
                password: password,
                role: 'user',
                email: email,
                phone: phone
            };
            
            registeredUsers.push(newUser);
            saveRegisteredUsers(); // Save to localStorage
            
            alert('Registrasi berhasil! Silakan login dengan akun baru Anda.');
            
            // Clear form and switch to login
            document.getElementById('registerForm').reset();
            showLoginForm();
        });

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = registeredUsers.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user.username;
                userRole = user.role === 'admin' ? 'Administrator' : 'User';
                
                // Save session to localStorage
                saveUserSession();
                
                document.getElementById('loginModal').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                document.getElementById('currentUser').textContent = currentUser;
                document.getElementById('userRole').textContent = userRole;
                
                if (userRole === 'Administrator') {
                    document.getElementById('adminMenu').classList.remove('hidden');
                }
                
                // Load user's balance
                loadUserBalance();
                
                showSection('dashboard');
                updateDashboard();
            } else {
                alert('Username atau password salah!');
            }
        });

        // Logout functionality
        function logout() {
            // Clear session data
            currentUser = null;
            userRole = null;
            clearUserSession(); // Clear from localStorage
            
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('adminMenu').classList.add('hidden');
            
            // Reset forms
            document.getElementById('loginForm').reset();
            document.getElementById('registerForm').reset();
            
            // Show login form by default
            showLoginForm();
        }

        // Navigation functionality
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-blue-50', 'text-blue-600');
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').classList.remove('hidden');
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'products': 'Daftar Kuota',
                'orders': 'Pesanan Saya',
                'topup': 'Top Up Saldo',
                'topupAdmin': 'Konfirmasi Top Up',
                'manage': 'Kelola Kuota'
            };
            document.getElementById('pageTitle').textContent = titles[sectionName];
            
            // Update content based on section
            if (sectionName === 'products') {
                renderQuotaList();
            } else if (sectionName === 'orders') {
                renderOrdersList();
            } else if (sectionName === 'topup') {
                renderTopupHistory();
            } else if (sectionName === 'topupAdmin') {
                renderAdminTopupSection();
            } else if (sectionName === 'manage') {
                renderManageQuotaList();
            } else if (sectionName === 'dashboard') {
                updateDashboard();
            }
        }

        // Update dashboard
        function updateDashboard() {
            document.getElementById('totalQuota').textContent = quotaData.length;
            document.getElementById('myOrders').textContent = orders.length;
            
            // Update balance display
            const balanceElements = document.querySelectorAll('.balance-display');
            balanceElements.forEach(el => {
                el.textContent = `Rp ${userBalance.toLocaleString()}`;
            });
            
            // Show popular quota (first 3 items)
            const popularContainer = document.getElementById('popularQuota');
            popularContainer.innerHTML = '';
            
            quotaData.slice(0, 3).forEach(quota => {
                const quotaCard = createQuotaCard(quota, true);
                popularContainer.appendChild(quotaCard);
            });
        }

        // Create quota card
        function createQuotaCard(quota, isPopular = false) {
            const card = document.createElement('div');
            card.className = 'bg-gradient-to-r from-blue-500 to-purple-600 text-white p-3 md:p-4 rounded-xl card-hover';
            
            card.innerHTML = `
                <div class="flex items-center justify-between mb-2 md:mb-3">
                    <span class="text-xs md:text-sm font-medium bg-white bg-opacity-20 px-2 py-1 rounded-full">${quota.provider}</span>
                    ${isPopular ? '<i class="fas fa-star text-yellow-300 text-sm md:text-base"></i>' : ''}
                </div>
                <h4 class="text-base md:text-lg font-bold mb-1 md:mb-2">${quota.quota}</h4>
                <p class="text-xs md:text-sm opacity-90 mb-2 md:mb-3">${quota.duration}</p>
                <div class="flex items-center justify-between">
                    <span class="text-lg md:text-xl font-bold">Rp ${quota.price.toLocaleString()}</span>
                    ${userRole !== 'Administrator' ? `<button onclick="openPurchaseModal(${quota.id})" class="bg-white text-blue-600 px-2 md:px-3 py-1 rounded-lg text-xs md:text-sm font-medium hover:bg-gray-100 transition duration-200">Beli</button>` : ''}
                </div>
            `;
            
            return card;
        }

        // Render quota list
        function renderQuotaList() {
            const container = document.getElementById('quotaList');
            const filter = document.getElementById('providerFilter').value;
            
            container.innerHTML = '';
            
            const filteredQuota = filter ? quotaData.filter(q => q.provider === filter) : quotaData;
            
            filteredQuota.forEach(quota => {
                const card = document.createElement('div');
                card.className = 'bg-white border border-gray-200 rounded-xl p-6 card-hover';
                
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm font-medium text-gray-600 bg-gray-100 px-3 py-1 rounded-full">${quota.provider}</span>
                        <i class="fas fa-wifi text-blue-600 text-xl"></i>
                    </div>
                    <h4 class="text-xl font-bold text-gray-800 mb-2">${quota.quota}</h4>
                    <p class="text-gray-600 mb-4">${quota.duration}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-2xl font-bold text-blue-600">Rp ${quota.price.toLocaleString()}</span>
                        ${userRole !== 'Administrator' ? `<button onclick="openPurchaseModal(${quota.id})" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200"><i class="fas fa-shopping-cart mr-2"></i>Beli</button>` : ''}
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // Provider filter
        document.getElementById('providerFilter').addEventListener('change', renderQuotaList);

        // Purchase modal
        function openPurchaseModal(quotaId) {
            selectedQuota = quotaData.find(q => q.id === quotaId);
            if (!selectedQuota) return;
            
            const detailsContainer = document.getElementById('purchaseDetails');
            detailsContainer.innerHTML = `
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-600">Provider:</span>
                        <span class="font-medium">${selectedQuota.provider}</span>
                    </div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-600">Kuota:</span>
                        <span class="font-medium">${selectedQuota.quota}</span>
                    </div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm text-gray-600">Masa Aktif:</span>
                        <span class="font-medium">${selectedQuota.duration}</span>
                    </div>
                    <div class="flex items-center justify-between border-t pt-2 mt-2">
                        <span class="text-sm text-gray-600">Total:</span>
                        <span class="text-lg font-bold text-blue-600">Rp ${selectedQuota.price.toLocaleString()}</span>
                    </div>
                </div>
            `;
            
            document.getElementById('purchaseModal').classList.remove('hidden');
        }

        function closePurchaseModal() {
            document.getElementById('purchaseModal').classList.add('hidden');
            document.getElementById('phoneNumber').value = '';
            selectedQuota = null;
        }

        // Purchase form
        document.getElementById('purchaseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const phoneNumber = document.getElementById('phoneNumber').value;
            
            if (!phoneNumber) {
                alert('Mohon masukkan nomor HP!');
                return;
            }
            
            if (!/^08\d{8,11}$/.test(phoneNumber)) {
                alert('Format nomor HP tidak valid! Gunakan format 08xxxxxxxxxx');
                return;
            }
            
            // Check if user has enough balance
            if (userBalance < selectedQuota.price) {
                alert(`Saldo tidak mencukupi! Saldo Anda: Rp ${userBalance.toLocaleString()}, Harga kuota: Rp ${selectedQuota.price.toLocaleString()}`);
                return;
            }
            
            // Deduct balance
            userBalance -= selectedQuota.price;
            
            // Save updated balance
            saveUserBalance();
            
            const order = {
                id: orders.length + 1,
                quota: selectedQuota,
                phoneNumber: phoneNumber,
                date: new Date().toLocaleDateString('id-ID'),
                time: new Date().toLocaleTimeString('id-ID'),
                status: 'Berhasil'
            };
            
            orders.push(order);
            
            alert(`Pembelian berhasil! Kuota ${selectedQuota.quota} ${selectedQuota.provider} telah diaktifkan ke nomor ${phoneNumber}. Saldo tersisa: Rp ${userBalance.toLocaleString()}`);
            closePurchaseModal();
            updateDashboard();
        });

        // Render orders list
        function renderOrdersList() {
            const container = document.getElementById('ordersList');
            
            if (orders.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-shopping-cart text-4xl mb-4"></i>
                        <p>Belum ada pesanan</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            orders.forEach(order => {
                const orderCard = document.createElement('div');
                orderCard.className = 'bg-gray-50 rounded-lg p-4 border border-gray-200';
                
                orderCard.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium text-gray-600">Order #${order.id}</span>
                        <span class="text-sm px-2 py-1 bg-green-100 text-green-800 rounded-full">${order.status}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div>
                            <p class="text-sm text-gray-600">Provider</p>
                            <p class="font-medium">${order.quota.provider}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Kuota</p>
                            <p class="font-medium">${order.quota.quota}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Nomor HP</p>
                            <p class="font-medium">${order.phoneNumber}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Tanggal</p>
                            <p class="font-medium">${order.date}</p>
                            ${order.time ? `<p class="text-xs text-gray-500">${order.time}</p>` : ''}
                        </div>
                    </div>
                    <div class="flex items-center justify-between border-t pt-3">
                        <span class="text-lg font-bold text-blue-600">Rp ${order.quota.price.toLocaleString()}</span>
                        <button class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            <i class="fas fa-download mr-1"></i>Download Invoice
                        </button>
                    </div>
                `;
                
                container.appendChild(orderCard);
            });
        }

        // Admin manage quota
        function renderManageQuotaList() {
            const container = document.getElementById('manageQuotaList');
            container.innerHTML = '';
            
            quotaData.forEach(quota => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50';
                
                row.innerHTML = `
                    <td class="py-3 px-4">
                        <input type="checkbox" class="quota-checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500" 
                               value="${quota.id}" onchange="updateSelectedCount()">
                    </td>
                    <td class="py-3 px-4">${quota.provider}</td>
                    <td class="py-3 px-4">${quota.quota}</td>
                    <td class="py-3 px-4">Rp ${quota.price.toLocaleString()}</td>
                    <td class="py-3 px-4">${quota.duration}</td>
                    <td class="py-3 px-4">
                        <button onclick="deleteQuota(${quota.id}); return false;" class="text-red-600 hover:text-red-800 mr-2 px-2 py-1 rounded hover:bg-red-50" title="Hapus">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button onclick="editQuota(${quota.id}); return false;" class="text-blue-600 hover:text-blue-800 px-2 py-1 rounded hover:bg-blue-50" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                
                container.appendChild(row);
            });
            
            // Reset selection state
            document.getElementById('selectAllQuotas').checked = false;
            updateSelectedCount();
        }

        // Add quota modal
        function showAddQuotaModal() {
            document.getElementById('addQuotaModal').classList.remove('hidden');
        }

        function closeAddQuotaModal() {
            document.getElementById('addQuotaModal').classList.add('hidden');
            document.getElementById('addQuotaForm').reset();
        }

        // Add quota form
        document.getElementById('addQuotaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Generate new ID based on highest existing ID
            const maxId = quotaData.length > 0 ? Math.max(...quotaData.map(q => q.id)) : 0;
            
            const newQuota = {
                id: maxId + 1,
                provider: document.getElementById('newProvider').value,
                quota: document.getElementById('newQuota').value,
                price: parseInt(document.getElementById('newPrice').value),
                duration: document.getElementById('newDuration').value
            };
            
            quotaData.push(newQuota);
            saveQuotaData(); // Save to localStorage
            closeAddQuotaModal();
            renderManageQuotaList();
            updateDashboard();
            
            alert('Kuota berhasil ditambahkan!');
        });

        // Delete quota
        function deleteQuota(quotaId) {
            if (confirm('Apakah Anda yakin ingin menghapus kuota ini?')) {
                const quotaIndex = quotaData.findIndex(q => q.id === quotaId);
                if (quotaIndex !== -1) {
                    const deletedQuota = quotaData[quotaIndex];
                    quotaData.splice(quotaIndex, 1);
                    saveQuotaData(); // Save to localStorage
                    renderManageQuotaList();
                    updateDashboard();
                    if (document.getElementById('productsSection').classList.contains('hidden') === false) {
                        renderQuotaList(); // Update product list if currently viewing
                    }
                    alert(`Kuota ${deletedQuota.quota} ${deletedQuota.provider} berhasil dihapus!`);
                } else {
                    alert('Kuota tidak ditemukan!');
                }
            }
        }

        // Edit quota (simplified - just shows alert for demo)
        function editQuota(quotaId) {
            alert('Fitur edit akan segera tersedia!');
        }

        // Top Up Functions
        function selectAmount(amount) {
            // Clear custom amount
            document.getElementById('customAmount').value = '';
            
            // Update button styles
            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50');
                btn.classList.add('border-gray-300');
            });
            
            // Highlight selected button
            event.target.closest('.amount-btn').classList.remove('border-gray-300');
            event.target.closest('.amount-btn').classList.add('border-blue-500', 'bg-blue-50');
            
            // Store selected amount
            event.target.closest('.amount-btn').dataset.selected = amount;
        }

        // Top Up Form
        document.getElementById('topupForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            let amount = 0;
            const customAmount = document.getElementById('customAmount').value;
            const selectedBtn = document.querySelector('.amount-btn.border-blue-500');
            
            if (customAmount) {
                amount = parseInt(customAmount);
            } else if (selectedBtn) {
                amount = parseInt(selectedBtn.dataset.selected);
            }
            
            if (!amount || amount < 10000) {
                alert('Minimal top up Rp 10.000!');
                return;
            }
            
            const paymentMethod = document.getElementById('paymentMethod').value;
            await generatePaymentCode(amount, paymentMethod);
        });

        // Generate Payment Code
        async function generatePaymentCode(amount, method) {
            // Bank transfer - with unique code
            const uniqueCode = Math.floor(Math.random() * 999) + 1;
            const totalAmount = amount + uniqueCode;
            
            const bankAccounts = {
                //'bca': { name: 'BCA', number: '1234567890', holder: 'RFNSTORE' },
                //'mandiri': { name: 'Mandiri', number: '9876543210', holder: 'RFNSTORE' },
                'bri': { name: 'BRI', number: '617701027476538', holder: 'RIFAN AGUSTIAN' },
                //'bni': { name: 'BNI', number: '1111222233', holder: 'RFNSTORE' }
            };
            
            const bank = bankAccounts[method];
            
            const currentPaymentData = {
                id: 'TU' + Date.now(),
                username: currentUser,
                amount: amount,
                uniqueCode: uniqueCode,
                totalAmount: totalAmount,
                bank: bank,
                method: method,
                status: 'pending',
                createdAt: new Date(),
                expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000) // 24 hours
            };
            
            // Save to global storage
            allTopupRequests.push(currentPaymentData);
            saveAllTopupRequests();
            
            currentPayment = currentPaymentData;
            showPaymentModal();
            startPaymentTimer();
            
            // Update admin badge if admin is logged in
            updateAdminTopupBadge();
        }



        // Show Payment Modal
        function showPaymentModal() {
            const detailsContainer = document.getElementById('paymentDetails');
            
            // Bank Transfer Display
            detailsContainer.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <p class="text-sm text-gray-600 mb-1">Kode Pembayaran</p>
                        <p class="text-2xl font-bold text-blue-600">${currentPayment.id}</p>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Bank:</span>
                            <span class="font-medium">${currentPayment.bank.name}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">No. Rekening:</span>
                            <span class="font-medium" id="accountNumberDisplay">${currentPayment.bank.number}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Atas Nama:</span>
                            <span class="font-medium">${currentPayment.bank.holder}</span>
                        </div>
                        <div class="border-t pt-3">
                            <div class="flex justify-between mb-1">
                                <span class="text-sm text-gray-600">Nominal Top Up:</span>
                                <span>Rp ${currentPayment.amount.toLocaleString()}</span>
                            </div>
                            <div class="flex justify-between mb-2">
                                <span class="text-sm text-gray-600">Kode Unik:</span>
                                <span class="text-red-600 font-bold">Rp ${currentPayment.uniqueCode}</span>
                            </div>
                            <div class="flex justify-between font-bold text-lg border-t pt-2">
                                <span>Total Transfer:</span>
                                <span class="text-blue-600" id="totalAmountDisplay">Rp ${currentPayment.totalAmount.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-medium text-blue-800 mb-2">
                            <i class="fas fa-info-circle mr-2"></i>Cara Transfer:
                        </h4>
                        <ol class="text-sm text-blue-700 space-y-1 list-decimal list-inside">
                            <li>Buka aplikasi mobile banking atau ATM</li>
                            <li>Pilih menu Transfer ke Bank ${currentPayment.bank.name}</li>
                            <li>Masukkan nomor rekening: <strong>${currentPayment.bank.number}</strong></li>
                            <li>Masukkan nominal: <strong>Rp ${currentPayment.totalAmount.toLocaleString()}</strong></li>
                            <li>Pastikan nama penerima: <strong>${currentPayment.bank.holder}</strong></li>
                            <li>Konfirmasi dan kirim transfer</li>
                        </ol>
                    </div>
                    
                    <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <p class="text-xs text-yellow-700">
                            <i class="fas fa-exclamation-triangle mr-1"></i>
                            <strong>Penting:</strong> Transfer harus TEPAT sesuai nominal Rp ${currentPayment.totalAmount.toLocaleString()} (termasuk kode unik Rp ${currentPayment.uniqueCode}) agar saldo otomatis masuk ke akun Anda.
                        </p>
                    </div>
                    
                    <div class="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                        <p class="text-xs text-orange-700">
                            <i class="fas fa-clock mr-1"></i>
                            Setelah transfer, konfirmasi pembayaran melalui WhatsApp admin untuk proses manual.
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('paymentModal').classList.remove('hidden');
            
            // Show bank transfer buttons only
            document.getElementById('bankTransferButtons').classList.remove('hidden');
            document.getElementById('qrisButtons').classList.add('hidden');
        }

        // Payment Timer
        function startPaymentTimer() {
            const timerElement = document.getElementById('paymentTimer');
            const endTime = currentPayment.expiresAt.getTime();
            
            paymentTimer = setInterval(() => {
                const now = new Date().getTime();
                const timeLeft = endTime - now;
                
                if (timeLeft <= 0) {
                    clearInterval(paymentTimer);
                    timerElement.textContent = '00:00:00';
                    alert('Waktu pembayaran telah habis!');
                    closePaymentModal();
                    return;
                }
                
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                timerElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Copy Functions
        function copyAccountNumber() {
            const accountNumber = currentPayment.bank.number;
            navigator.clipboard.writeText(accountNumber).then(() => {
                alert('Nomor rekening berhasil disalin!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = accountNumber;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Nomor rekening berhasil disalin!');
            });
        }

        function copyAmount() {
            const amount = currentPayment.totalAmount.toString();
            navigator.clipboard.writeText(amount).then(() => {
                alert('Nominal transfer berhasil disalin!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = amount;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Nominal transfer berhasil disalin!');
            });
        }



        // Manual Top Up System - No automatic monitoring

        // WhatsApp confirmation function
        function confirmPaymentWhatsApp() {
            if (!currentPayment) return;
            
            const message = `Halo Admin RFNSTORE,

Saya ingin konfirmasi pembayaran top up:

 *Kode Pembayaran:* ${currentPayment.id}
 *Username:* ${currentUser}
 *Nominal Top Up:* Rp ${currentPayment.amount.toLocaleString()}
 *Kode Unik:* Rp ${currentPayment.uniqueCode}
 *Total Transfer:* Rp ${currentPayment.totalAmount.toLocaleString()}

 *Detail Transfer:*
Bank: ${currentPayment.bank.name}
No. Rekening: ${currentPayment.bank.number}
Atas Nama: ${currentPayment.bank.holder}

Mohon diproses segera. Terima kasih! `;

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/628885252823?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
        }

        // Close Payment Modal
        function closePaymentModal() {
            document.getElementById('paymentModal').classList.add('hidden');
            if (paymentTimer) {
                clearInterval(paymentTimer);
                paymentTimer = null;
            }
            
            // Add to history if payment was created
            if (currentPayment) {
                topupHistory.push(currentPayment);
                renderTopupHistory();
                
                console.log(` Manual payment created: ${currentPayment.id}`);
                console.log(` Transfer Rp ${currentPayment.totalAmount.toLocaleString()} ke ${currentPayment.bank.name} ${currentPayment.bank.number} (${currentPayment.bank.holder})`);
            }
            
            currentPayment = null;
        }

        // Render Top Up History
        function renderTopupHistory() {
            const container = document.getElementById('topupHistory');
            
            if (topupHistory.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-credit-card text-4xl mb-4"></i>
                        <p>Belum ada riwayat top up</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            // Sort by newest first
            const sortedHistory = [...topupHistory].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            sortedHistory.forEach(topup => {
                const statusColor = topup.status === 'success' ? 'green' : 
                                  topup.status === 'pending' ? 'yellow' : 
                                  topup.status === 'expired' ? 'gray' : 'red';
                const statusText = topup.status === 'success' ? 'Berhasil' : 
                                 topup.status === 'pending' ? 'Menunggu' : 
                                 topup.status === 'expired' ? 'Kedaluwarsa' : 'Gagal';
                const failReason = topup.failReason || '';
                
                const topupCard = document.createElement('div');
                topupCard.className = 'bg-gray-50 rounded-lg p-4 border border-gray-200';
                
                const paymentMethodDisplay = `
                    <div>
                        <p class="text-sm text-gray-600">Bank</p>
                        <p class="font-medium">${topup.bank.name}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Nominal</p>
                        <p class="font-medium">Rp ${topup.amount.toLocaleString()}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Kode Unik</p>
                        <p class="font-medium text-red-600">Rp ${topup.uniqueCode}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Total Transfer</p>
                        <p class="font-bold text-blue-600">Rp ${topup.totalAmount.toLocaleString()}</p>
                    </div>
                `;
                
                topupCard.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium text-gray-600">${topup.id}</span>
                        <span class="text-sm px-2 py-1 bg-${statusColor}-100 text-${statusColor}-800 rounded-full">${statusText}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        ${paymentMethodDisplay}
                        <div>
                            <p class="text-sm text-gray-600">Tanggal</p>
                            <p class="font-medium">${new Date(topup.createdAt).toLocaleDateString('id-ID')}</p>
                            <p class="text-xs text-gray-500">${new Date(topup.createdAt).toLocaleTimeString('id-ID')}</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between border-t pt-3">
                        <span class="text-lg font-bold text-blue-600">Rp ${topup.totalAmount.toLocaleString()}</span>
                        ${topup.status === 'pending' ? '<span class="text-xs text-gray-500">Menunggu pembayaran...</span>' : ''}
                        ${topup.status === 'failed' || topup.status === 'expired' ? `<span class="text-xs text-red-500">${failReason}</span>` : ''}
                        ${topup.status === 'success' ? '<span class="text-xs text-green-500"> Saldo sudah masuk</span>' : ''}
                    </div>
                `;
                
                container.appendChild(topupCard);
            });
        }

        // Checkbox selection functions
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAllQuotas');
            const quotaCheckboxes = document.querySelectorAll('.quota-checkbox');
            
            quotaCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const selectedCheckboxes = document.querySelectorAll('.quota-checkbox:checked');
            const count = selectedCheckboxes.length;
            const totalCheckboxes = document.querySelectorAll('.quota-checkbox');
            
            // Update counter
            document.getElementById('selectedCount').textContent = count;
            
            // Show/hide delete button
            const deleteBtn = document.getElementById('deleteSelectedBtn');
            if (count > 0) {
                deleteBtn.classList.remove('hidden');
            } else {
                deleteBtn.classList.add('hidden');
            }
            
            // Update select all checkbox state
            const selectAllCheckbox = document.getElementById('selectAllQuotas');
            if (count === 0) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = false;
            } else if (count === totalCheckboxes.length) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = true;
            } else {
                selectAllCheckbox.indeterminate = true;
                selectAllCheckbox.checked = false;
            }
        }

        function deleteSelectedQuotas() {
            const selectedCheckboxes = document.querySelectorAll('.quota-checkbox:checked');
            const selectedIds = Array.from(selectedCheckboxes).map(cb => parseInt(cb.value));
            
            if (selectedIds.length === 0) {
                alert('Pilih kuota yang ingin dihapus terlebih dahulu!');
                return;
            }
            
            // Get quota details for confirmation
            const selectedQuotas = quotaData.filter(quota => selectedIds.includes(quota.id));
            const quotaNames = selectedQuotas.map(q => `${q.quota} ${q.provider}`).join(', ');
            
            const confirmMessage = `Apakah Anda yakin ingin menghapus ${selectedIds.length} kuota berikut?\n\n${quotaNames}`;
            
            if (confirm(confirmMessage)) {
                // Remove selected quotas
                const originalLength = quotaData.length;
                quotaData = quotaData.filter(quota => !selectedIds.includes(quota.id));
                const deletedCount = originalLength - quotaData.length;
                
                if (deletedCount > 0) {
                    saveQuotaData(); // Save to localStorage
                    
                    // Update displays
                    renderManageQuotaList();
                    updateDashboard();
                    if (document.getElementById('productsSection').classList.contains('hidden') === false) {
                        renderQuotaList(); // Update product list if currently viewing
                    }
                    
                    alert(`${deletedCount} kuota berhasil dihapus!`);
                } else {
                    alert('Tidak ada kuota yang dihapus!');
                }
            }
        }

        // Save user session to localStorage
        function saveUserSession() {
            if (currentUser) {
                localStorage.setItem('currentUser', currentUser);
                localStorage.setItem('userRole', userRole);
            }
        }
        
        // Load user session from localStorage
        function loadUserSession() {
            const savedUser = localStorage.getItem('currentUser');
            const savedRole = localStorage.getItem('userRole');
            
            if (savedUser && savedRole) {
                currentUser = savedUser;
                userRole = savedRole;
                
                // Hide login modal and show main app
                document.getElementById('loginModal').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                // Update UI
                document.getElementById('currentUser').textContent = currentUser;
                document.getElementById('userRole').textContent = userRole;
                
                // Show admin menu if user is admin
                if (userRole === 'Administrator') {
                    document.getElementById('adminMenu').classList.remove('hidden');
                }
                
                // Show dashboard
                // Load user's balance
                loadUserBalance();
                
                showSection('dashboard');
                updateDashboard();
                
                return true;
            }
            return false;
        }
        
        // Clear user session
        function clearUserSession() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userRole');
        }
        
        // Admin Top Up Management Functions
        function updateAdminTopupBadge() {
            const pendingCount = allTopupRequests.filter(req => req.status === 'pending').length;
            const badge = document.getElementById('pendingTopupBadge');
            
            if (pendingCount > 0) {
                badge.textContent = pendingCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function renderAdminTopupSection() {
            updateAdminTopupStats();
            renderPendingTopups();
            renderAllTopupHistory();
            updateAdminTopupBadge();
        }

        function updateAdminTopupStats() {
            const today = new Date().toDateString();
            const pendingCount = allTopupRequests.filter(req => req.status === 'pending').length;
            const todaySuccess = allTopupRequests.filter(req => 
                req.status === 'success' && new Date(req.createdAt).toDateString() === today
            );
            const todayTotal = todaySuccess.reduce((sum, req) => sum + req.amount, 0);

            document.getElementById('pendingTopupCount').textContent = pendingCount;
            document.getElementById('todaySuccessCount').textContent = todaySuccess.length;
            document.getElementById('todayTotalAmount').textContent = `Rp ${todayTotal.toLocaleString()}`;
        }

        function renderPendingTopups() {
            const container = document.getElementById('pendingTopupList');
            const pendingTopups = allTopupRequests.filter(req => req.status === 'pending');

            if (pendingTopups.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-check-circle text-4xl mb-4"></i>
                        <p>Tidak ada top up yang menunggu konfirmasi</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';

            pendingTopups.forEach(topup => {
                const topupCard = document.createElement('div');
                topupCard.className = 'bg-yellow-50 border border-yellow-200 rounded-lg p-4';

                const timeLeft = new Date(topup.expiresAt) - new Date();
                const hoursLeft = Math.max(0, Math.floor(timeLeft / (1000 * 60 * 60)));
                const minutesLeft = Math.max(0, Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60)));

                topupCard.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <span class="text-sm font-medium text-gray-600">${topup.id}</span>
                            <span class="ml-2 text-xs px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full">Pending</span>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-gray-500">Sisa waktu:</p>
                            <p class="text-sm font-medium ${timeLeft > 0 ? 'text-orange-600' : 'text-red-600'}">
                                ${timeLeft > 0 ? `${hoursLeft}j ${minutesLeft}m` : 'Kedaluwarsa'}
                            </p>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-sm text-gray-600">Username</p>
                            <p class="font-medium">${topup.username}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Bank</p>
                            <p class="font-medium">${topup.bank.name}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Nominal</p>
                            <p class="font-medium">Rp ${topup.amount.toLocaleString()}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Total Transfer</p>
                            <p class="font-bold text-blue-600">Rp ${topup.totalAmount.toLocaleString()}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Kode Unik</p>
                            <p class="font-medium text-red-600">Rp ${topup.uniqueCode}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Tanggal</p>
                            <p class="font-medium">${new Date(topup.createdAt).toLocaleDateString('id-ID')}</p>
                            <p class="text-xs text-gray-500">${new Date(topup.createdAt).toLocaleTimeString('id-ID')}</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg p-3 mb-4">
                        <p class="text-sm text-gray-600 mb-1">Detail Transfer:</p>
                        <p class="text-sm"><strong>Bank:</strong> ${topup.bank.name}</p>
                        <p class="text-sm"><strong>No. Rekening:</strong> ${topup.bank.number}</p>
                        <p class="text-sm"><strong>Atas Nama:</strong> ${topup.bank.holder}</p>
                    </div>

                    <div class="flex space-x-3">
                        <button onclick="approveTopup('${topup.id}')" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition duration-200">
                            <i class="fas fa-check mr-2"></i>Setujui
                        </button>
                        <button onclick="rejectTopup('${topup.id}')" class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition duration-200">
                            <i class="fas fa-times mr-2"></i>Tolak
                        </button>
                        <button onclick="showTopupDetails('${topup.id}')" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-200">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                `;

                container.appendChild(topupCard);
            });
        }

        function renderAllTopupHistory() {
            const container = document.getElementById('allTopupHistory');
            const statusFilter = document.getElementById('statusFilter')?.value || '';
            const dateFilter = document.getElementById('dateFilter')?.value || '';

            let filteredTopups = [...allTopupRequests];

            // Apply status filter
            if (statusFilter) {
                filteredTopups = filteredTopups.filter(topup => topup.status === statusFilter);
            }

            // Apply date filter
            if (dateFilter) {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                
                filteredTopups = filteredTopups.filter(topup => {
                    const topupDate = new Date(topup.createdAt);
                    
                    switch(dateFilter) {
                        case 'today':
                            return topupDate >= today;
                        case 'week':
                            return topupDate >= new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        case 'month':
                            return topupDate >= new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                        default:
                            return true;
                    }
                });
            }

            // Sort by newest first
            filteredTopups.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            if (filteredTopups.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-history text-4xl mb-4"></i>
                        <p>Tidak ada riwayat top up</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';

            filteredTopups.forEach(topup => {
                const statusColor = topup.status === 'success' ? 'green' : 
                                  topup.status === 'pending' ? 'yellow' : 
                                  topup.status === 'expired' ? 'gray' : 'red';
                const statusText = topup.status === 'success' ? 'Berhasil' : 
                                 topup.status === 'pending' ? 'Menunggu' : 
                                 topup.status === 'expired' ? 'Kedaluwarsa' : 'Ditolak';

                const topupCard = document.createElement('div');
                topupCard.className = 'bg-gray-50 rounded-lg p-4 border border-gray-200';

                topupCard.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <span class="text-sm font-medium text-gray-600">${topup.id}</span>
                            <span class="ml-2 text-xs px-2 py-1 bg-${statusColor}-100 text-${statusColor}-800 rounded-full">${statusText}</span>
                        </div>
                        <span class="text-sm text-gray-500">${new Date(topup.createdAt).toLocaleDateString('id-ID')}</span>
                    </div>

                    <div class="grid grid-cols-3 gap-4 mb-3">
                        <div>
                            <p class="text-sm text-gray-600">Username</p>
                            <p class="font-medium">${topup.username}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Bank</p>
                            <p class="font-medium">${topup.bank.name}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Nominal</p>
                            <p class="font-medium">Rp ${topup.amount.toLocaleString()}</p>
                        </div>
                    </div>

                    <div class="flex items-center justify-between border-t pt-3">
                        <span class="text-lg font-bold text-blue-600">Rp ${topup.totalAmount.toLocaleString()}</span>
                        ${topup.status === 'pending' ? `
                            <div class="space-x-2">
                                <button onclick="approveTopup('${topup.id}')" class="text-green-600 hover:text-green-800 text-sm px-2 py-1 rounded hover:bg-green-50">
                                    <i class="fas fa-check mr-1"></i>Setujui
                                </button>
                                <button onclick="rejectTopup('${topup.id}')" class="text-red-600 hover:text-red-800 text-sm px-2 py-1 rounded hover:bg-red-50">
                                    <i class="fas fa-times mr-1"></i>Tolak
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;

                container.appendChild(topupCard);
            });
        }

        function approveTopup(topupId) {
            const topup = allTopupRequests.find(req => req.id === topupId);
            if (!topup) {
                alert('Top up tidak ditemukan!');
                return;
            }

            if (confirm(`Setujui top up ${topup.username} sebesar Rp ${topup.amount.toLocaleString()}?`)) {
                // Update status
                topup.status = 'success';
                topup.approvedAt = new Date();
                topup.approvedBy = currentUser;

                // Add balance to user (simulate)
                // In real app, this would update the user's actual balance
                console.log(` Saldo ${topup.username} ditambah Rp ${topup.amount.toLocaleString()}`);

                // Save changes
                saveAllTopupRequests();

                // Refresh displays
                renderAdminTopupSection();

                alert(`Top up berhasil disetujui! Saldo ${topup.username} telah ditambah Rp ${topup.amount.toLocaleString()}`);
            }
        }

        function rejectTopup(topupId) {
            const topup = allTopupRequests.find(req => req.id === topupId);
            if (!topup) {
                alert('Top up tidak ditemukan!');
                return;
            }

            const reason = prompt(`Alasan penolakan top up ${topup.username}:`);
            if (reason !== null) {
                // Update status
                topup.status = 'failed';
                topup.rejectedAt = new Date();
                topup.rejectedBy = currentUser;
                topup.failReason = reason || 'Ditolak oleh admin';

                // Save changes
                saveAllTopupRequests();

                // Refresh displays
                renderAdminTopupSection();

                alert(`Top up berhasil ditolak!`);
            }
        }

        function showTopupDetails(topupId) {
            const topup = allTopupRequests.find(req => req.id === topupId);
            if (!topup) {
                alert('Top up tidak ditemukan!');
                return;
            }

            const details = `
Detail Top Up:

ID: ${topup.id}
Username: ${topup.username}
Nominal: Rp ${topup.amount.toLocaleString()}
Kode Unik: Rp ${topup.uniqueCode}
Total Transfer: Rp ${topup.totalAmount.toLocaleString()}

Bank: ${topup.bank.name}
No. Rekening: ${topup.bank.number}
Atas Nama: ${topup.bank.holder}

Status: ${topup.status}
Dibuat: ${new Date(topup.createdAt).toLocaleString('id-ID')}
Kedaluwarsa: ${new Date(topup.expiresAt).toLocaleString('id-ID')}

${topup.approvedBy ? `Disetujui oleh: ${topup.approvedBy} pada ${new Date(topup.approvedAt).toLocaleString('id-ID')}` : ''}
${topup.rejectedBy ? `Ditolak oleh: ${topup.rejectedBy} pada ${new Date(topup.rejectedAt).toLocaleString('id-ID')}` : ''}
${topup.failReason ? `Alasan: ${topup.failReason}` : ''}
            `;

            alert(details);
        }

        function refreshTopupList() {
            renderAdminTopupSection();
            alert('Data top up berhasil diperbarui!');
        }

        // Add event listeners for filters
        document.addEventListener('DOMContentLoaded', function() {
            // Status filter
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.addEventListener('change', renderAllTopupHistory);
            }

            // Date filter
            const dateFilter = document.getElementById('dateFilter');
            if (dateFilter) {
                dateFilter.addEventListener('change', renderAllTopupHistory);
            }
        });

        // Mobile sidebar functions
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            if (sidebar.classList.contains('-translate-x-full')) {
                // Show sidebar
                sidebar.classList.remove('-translate-x-full');
                sidebar.classList.add('translate-x-0');
                overlay.classList.remove('hidden');
            } else {
                // Hide sidebar
                closeMobileSidebar();
            }
        }

        function closeMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            sidebar.classList.add('-translate-x-full');
            sidebar.classList.remove('translate-x-0');
            overlay.classList.add('hidden');
        }

        // Close mobile sidebar when clicking nav items
        document.addEventListener('click', function(e) {
            if (e.target.closest('.nav-item')) {
                // Small delay to allow navigation to complete
                setTimeout(closeMobileSidebar, 100);
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Try to load existing session first
            const sessionLoaded = loadUserSession();
            
            // If no session found, show login modal
            if (!sessionLoaded) {
                document.getElementById('loginModal').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
            
            // Update admin badge on load
            if (userRole === 'Administrator') {
                updateAdminTopupBadge();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976d7621d5cdfc2e',t:'MTc1NjQ4NTMyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
